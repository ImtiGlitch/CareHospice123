<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="noindex,nofollow">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <title>Distance Calculation and Map Image</title>
    <style>
        * { font-family: "Roboto", sans-serif; }
        #mapImage { border: 1px solid #cfcfcf; max-width: 640px; margin: 15px auto 0; display: block; border-radius: 8px; }
        #result_view { display: none; }
        #visitingLocations { text-align: center; padding: 10px; border-radius: 5px; margin-top: 10px; cursor: pointer; width: 100%; }
        #totalDistMiles { font-weight: 600; font-size: 20px; margin: 8px 0; text-align: center; color: #005151; }
        .location_head { font-weight: 600; font-size: 18px; display: block; text-align: center; color: #5d5d5d; }
        ul#locationsList { margin: 0; padding: 0; list-style: none; border-radius: 5px; overflow: hidden; border: 1px solid #ddd; }
        ul#locationsList li { font-size: 15px; padding: 10px 10px; }
        ul#locationsList li:nth-child(even) { background-color: #f0f0f0; color: #005151; }
        ul#locationsList li:nth-child(odd) { background-color: #ffffff; color: #ed5915; }
        #errorMessage { margin-bottom: 0; }
        .custom-no-emp.d-flex-adjust { display: block !important; }
        .custom-msg-small-font { font-size: 14px; text-align: center; line-height: 1.15em; color: #8e8e8e; }
        i.far.fa-times-circle { font-size: 30px; color: #12ab3e; }
        @media only screen and (max-width: 767px) {
            .custom-head { font-size: 16px !important; }
            #form_view .card { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); min-width: 300px; }
            #custom_image { width: 30px; position: absolute; top: 6px; right: 16px; }
        }
    </style>
</head>

<body>
    <div id="form_view">
        <div class="container">
            <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <div class="card mt-3">
                        <div class="card-header bg-success-subtle">
                            <h5 class="text-center my-1 custom-head">Mileage and Map</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="select_date" class="form-label fw-semibold">Select Date:</label>
                                <input type="date" id="select_date" name="select_date" class="form-control" required>
                            </div>
                            <div class="text-center position-relative">
                                <button type="submit" class="btn btn-success px-5 py-2" style="display:none;" onclick="loginWithKronos()">Calculate</button>
                                <img id="custom_image" src="https://cloudapper.ai/app_files/loading.gif" width="64" alt="processing..." style="display: none;" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4"></div>
            </div>
        </div>
    </div>

    <div id="result_view">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="results">
                        <div id="display_miles_map">
                            <div id="custom_top_msg" style="display: none;" class="custom-msg-small-font">Please confirm visit schedule is accurate and complete.</div>
                            <div id="totalDistMiles" style="display: none;">Total Distance: <span id="totalDistance"></span> Miles</div>
                            <img id="mapImage" src="" alt="Map Image" width="100%" style="display: none;">
                            <div id="visitingLocations" class="btn btn-info" style="display: none;">List of Addresses</div>
                        </div>
                        <div id="visitingLocationsList" style="display: none;">
                            <div id="close_locationsList" class="d-flex justify-content-between">
                                <div class="p-2"><span class="location_head">Visiting Locations:</span></div>
                                <div class="p-2"><i class="far fa-times-circle"></i></div>
                            </div>
                            <ul id="locationsList"></ul>
                        </div>
                    </div>
                    <div class="alert alert-danger mt-2 text-center" id="errorMessage" style="display: none;"></div>
                </div>
                <div class="col-md-4"></div>
                <div class="col-md-4 text-center my-2">
                    <div class="d-flex justify-content-between custom-no-emp">
                        <div class="p-2"><button class="btn btn-secondary px-4 reloadForm">Back</button></div>
                        <div class="p-2"><button id="customSubmitBtnShowHide" class="btn btn-success px-4 submitBtn">Accept</button></div>
                    </div>
                    <input type="hidden" name="auth_Code" id="auth_Code" value="" />
                    <input type="hidden" name="get_date" id="get_date" value="" />
                    <input type="hidden" name="get_mileage" id="get_mileage" value="" />
                    <input type="hidden" name="emp_id" id="emp_id" value="" />
                    <div class="text-center" style="display: table; margin: 0 auto;">
                        <img id="custom_image_submit" src="https://cloudapper.ai/app_files/loading.gif" width="32" alt="processing..." style="display: none;" />
                    </div>
                    <div id="check_submit" class="pt-2"></div>
                </div>
                <div class="col-md-4"></div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <script>
        function formatDateLocal(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function loginWithKronos() {
            console.log("Triggered loginWithKronos()");
            // Add your existing auth code + token logic here
        }

        // Auto-trigger on page load
        window.addEventListener("DOMContentLoaded", function () {
            const today = new Date();
            const todayStr = formatDateLocal(today);
            document.getElementById("select_date").value = todayStr;
            loginWithKronos();
        });
    </script>
</body>
</html>
